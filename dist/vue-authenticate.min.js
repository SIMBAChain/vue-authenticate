/**
 * vue-authenticate v1.5.9
 * https://github.com/dgrubelic/vue-authenticate
 * Released under the MIT License.
 * 
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("crypto-js/sha256"),require("crypto-js/enc-base64"),require("crypto-js/lib-typedarrays")):"function"==typeof define&&define.amd?define(["crypto-js/sha256","crypto-js/enc-base64","crypto-js/lib-typedarrays"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).VueAuthenticate=t(e.sha256,e.Base64,e.WordArray)}(this,(function(e,t,o){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=r(e),i=r(t),s=r(o);function a(e){return void 0===e}function p(e){return null!==e&&"object"==typeof e}function u(e){return"function"==typeof e}function h(e,t){return null==e||null==t||Object.keys(t).forEach((function(o){"[object Object]"==Object.prototype.toString.call(t[o])?"[object Object]"!=Object.prototype.toString.call(e[o])?e[o]=t[o]:e[o]=h(e[o],t[o]):e[o]=t[o]})),e}function c(e,t){if(/^(?:[a-z]+:)?\/\//i.test(t))return t;var o=[e,t].join("/");return o.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")}function l(e){var t="https:"===e.protocol;return e.protocol+"//"+e.hostname+":"+(e.port||(t?"443":"80"))+(/^\//.test(e.pathname)?e.pathname:"/"+e.pathname)}function f(e){var t,o,r={};return(e||"").split("&").forEach((function(e){e&&(o=e.split("="),t=decodeURIComponent(o[0]),r[t]=!o[1]||decodeURIComponent(o[1]))})),r}function d(e){var t;if("undefined"!=typeof module&&module.exports)try{t=require("buffer").Buffer}catch(e){}var o=String.fromCharCode,r=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),n=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return o(55296+(t>>>10))+o(56320+(1023&t));case 3:return o((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return o((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}};return(t?function(e){return(e.constructor===t.constructor?e:new t(e,"base64")).toString()}:function(e){return atob(e).replace(r,n)})(String(e).replace(/[-_]/g,(function(e){return"-"===e?"+":"/"})).replace(/[^A-Za-z0-9\+\/]/g,""))}function g(e){var t=e.path,o=e.domain,r=e.expires,n=e.secure;return[null==t?"":";path="+t,null==o?"":";domain="+o,null==r?"":";expires="+r.toUTCString(),null==n||!1===n?"":";secure"].join("")}function m(e,t,o){return[encodeURIComponent(e),"=",encodeURIComponent(t),g(o)].join("")}function v(e,t){for(var o=void 0,r=e,n=t.split("."),i=0;i<n.length;i++){var s=n[i];if(!p(o=r[s]))break;r=r[s]}return o}function y(e,t,o,r){return(e=e||{}).url=e.url||t.url||c(t.baseUrl,t.loginUrl),e[t.requestDataKey]=r||e[t.requestDataKey],e.method=e.method||"POST",e.withCredentials=e.withCredentials||t.withCredentials,e}"function"!=typeof Object.assign&&(Object.assign=function(e,t){var o=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1;n<arguments.length;n++){var i=o[n];if(null!=i)for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])}return r});var w=setTimeout;function k(){}function _(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],U(e,this)}function I(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,_._immediateFn((function(){var o=1===e._state?t.onFulfilled:t.onRejected;if(null!==o){var r;try{r=o(e._value)}catch(e){return void T(t.promise,e)}C(t.promise,r)}else(1===e._state?C:T)(t.promise,e._value)}))):e._deferreds.push(t)}function C(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var o=t.then;if(t instanceof _)return e._state=3,e._value=t,void b(e);if("function"==typeof o)return void U((r=o,n=t,function(){r.apply(n,arguments)}),e)}e._state=1,e._value=t,b(e)}catch(t){T(e,t)}var r,n}function T(e,t){e._state=2,e._value=t,b(e)}function b(e){2===e._state&&0===e._deferreds.length&&_._immediateFn((function(){e._handled||_._unhandledRejectionFn(e._value)}));for(var t=0,o=e._deferreds.length;t<o;t++)I(e,e._deferreds[t]);e._deferreds=null}function P(e,t,o){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=o}function U(e,t){var o=!1;try{e((function(e){o||(o=!0,C(t,e))}),(function(e){o||(o=!0,T(t,e))}))}catch(e){if(o)return;o=!0,T(t,e)}}_.prototype.catch=function(e){return this.then(null,e)},_.prototype.then=function(e,t){var o=new this.constructor(k);return I(this,new P(e,t,o)),o},_.all=function(e){var t=Array.prototype.slice.call(e);return new _((function(e,o){if(0===t.length)return e([]);var r=t.length;function n(i,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,(function(e){n(i,e)}),o)}t[i]=s,0==--r&&e(t)}catch(e){o(e)}}for(var i=0;i<t.length;i++)n(i,t[i])}))},_.resolve=function(e){return e&&"object"==typeof e&&e.constructor===_?e:new _((function(t){t(e)}))},_.reject=function(e){return new _((function(t,o){o(e)}))},_.race=function(e){return new _((function(t,o){for(var r=0,n=e.length;r<n;r++)e[r].then(t,o)}))},_._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){w(e,0)},_._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},_._setImmediateFn=function(e){_._immediateFn=e},_._setUnhandledRejectionFn=function(e){_._unhandledRejectionFn=e};var j="undefined"!=typeof document?document:{createElement:function(){}},R="undefined"!=typeof window?window:{atob:function(){},open:function(){},location:{},localStorage:{setItem:function(){},getItem:function(){},removeItem:function(){}},sessionStorage:{setItem:function(){},getItem:function(){},removeItem:function(){}}};function S(){try{return R.location.hostname}catch(e){}return""}function E(e){try{return a(e)?R.location.origin:""+R.location.origin+e}catch(e){}return e||null}var O={baseUrl:null,tokenPath:"access_token",refreshTokenPath:"refresh_token",tokenName:"token",tokenPrefix:"vueauth",tokenHeader:"Authorization",tokenType:"Bearer",expirationName:"expiration",expirationPrefix:null,loginUrl:"/auth/login",registerUrl:"/auth/register",logoutUrl:null,refreshUrl:"/auth/login/refresh",storageType:"localStorage",storageNamespace:"vue-authenticate",cookieStorage:{domain:S(),path:"/",secure:!1},requestDataKey:"data",responseDataKey:"data",last_token_refresh_attempt:null,refreshAuthFailInterceptors:[],bindRequestInterceptor:null,bindResponseInterceptor:null,providers:{facebook:{name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:E("/"),requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",oauthType:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:E(),requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:452,height:633}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:E(),optionalUrlParams:["scope"],scope:["user:email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",authorizationEndpoint:"https://api.instagram.com/oauth/authorize",redirectUri:E(),requiredUrlParams:["scope"],scope:["basic"],scopeDelimiter:"+",oauthType:"2.0",popupOptions:{width:null,height:null}},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:E(),oauthType:"1.0",popupOptions:{width:495,height:645}},bitbucket:{name:"bitbucket",url:"/auth/bitbucket",authorizationEndpoint:"https://bitbucket.org/site/oauth2/authorize",redirectUri:E("/"),optionalUrlParams:["scope"],scope:["email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",redirectUri:E(),requiredUrlParams:["state","scope"],scope:["r_emailaddress"],scopeDelimiter:" ",state:"STATE",oauthType:"2.0",popupOptions:{width:527,height:582}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",redirectUri:E(),requiredUrlParams:["display","scope"],scope:["wl.emails"],scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:500,height:560}},oauth1:{name:null,url:"/auth/oauth1",authorizationEndpoint:null,redirectUri:E(),oauthType:"1.0",popupOptions:null},oauth2:{name:null,url:"/auth/oauth2",clientId:null,redirectUri:E(),authorizationEndpoint:null,defaultUrlParams:["response_type","client_id","redirect_uri"],requiredUrlParams:null,optionalUrlParams:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,oauthType:"2.0",popupOptions:null,responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"}}}},x=function(e){this._defaultOptions=h({domain:S(),expires:null,path:"/",secure:!1},e)};x.prototype.setItem=function(e,t){var o=m(e,t,h({},this._defaultOptions));this._setCookie(o)},x.prototype.getItem=function(e){var t=function(e){if(void 0===e&&(e=""),0===e.length)return{};var t={},o=new RegExp("\\s*;\\s*");return e.split(o).forEach((function(e){var o=e.split("="),r=o[0],n=o[1],i=decodeURIComponent(r),s=decodeURIComponent(n);t[i]=s})),t}(this._getCookie());return t.hasOwnProperty(e)?t[e]:null},x.prototype.removeItem=function(e){var t=h({},this._defaultOptions),o=m(e,"",h(t,{expires:new Date(0)}));this._setCookie(o)},x.prototype._getCookie=function(){try{return"undefined"===j.cookie?"":j.cookie}catch(e){}return""},x.prototype._setCookie=function(e){try{j.cookie=e}catch(e){}};var A=function(e){this.namespace=e||null};A.prototype.setItem=function(e,t){R.localStorage.setItem(this._getStorageKey(e),t)},A.prototype.getItem=function(e){return R.localStorage.getItem(this._getStorageKey(e))},A.prototype.removeItem=function(e){R.localStorage.removeItem(this._getStorageKey(e))},A.prototype._getStorageKey=function(e){return this.namespace?[this.namespace,e].join("."):e};var q=function(e){this.namespace=e||null,this._storage={}};q.prototype.setItem=function(e,t){this._storage[this._getStorageKey(e)]=t},q.prototype.getItem=function(e){return this._storage[this._getStorageKey(e)]},q.prototype.removeItem=function(e){delete this._storage[this._getStorageKey(e)]},q.prototype._getStorageKey=function(e){return this.namespace?[this.namespace,e].join("."):e};var N=function(e){this.namespace=e||null};N.prototype.setItem=function(e,t){R.sessionStorage.setItem(this._getStorageKey(e),t)},N.prototype.getItem=function(e){return R.sessionStorage.getItem(this._getStorageKey(e))},N.prototype.removeItem=function(e){R.sessionStorage.removeItem(this._getStorageKey(e))},N.prototype._getStorageKey=function(e){return this.namespace?[this.namespace,e].join("."):e};var D=function(e,t,o){this.popup=null,this.url=e,this.name=t,this.popupOptions=o};D.prototype.open=function(e,t){try{return this.popup=R.open(this.url,this.name,this._stringifyOptions()),this.popup&&this.popup.focus&&this.popup.focus(),t?_.resolve():this.pooling(e)}catch(e){return _.reject(new Error("OAuth popup error occurred"))}},D.prototype.pooling=function(e){var t=this;return new _((function(o,r){var n=j.createElement("a");n.href=e;var i=l(n),s=setInterval((function(){t.popup&&!t.popup.closed&&void 0!==t.popup.closed||(clearInterval(s),s=null,r(new Error("Auth popup window closed")));try{if(l(t.popup.location)===i){if(t.popup.location.search||t.popup.location.hash){var e=f(t.popup.location.search.substring(1).replace(/\/$/,"")),n=f(t.popup.location.hash.substring(1).replace(/[\/$]/,"")),a=h({},e);(a=h(a,n)).error?r(new Error(a.error)):o(a)}else r(new Error("OAuth redirect has occurred but no query or hash parameters were found."));clearInterval(s),s=null,t.popup.close()}}catch(e){}}),250)}))},D.prototype._stringifyOptions=function(){var e=[];for(var t in this.popupOptions)a(this.popupOptions[t])||e.push(t+"="+this.popupOptions[t]);return e.join(",")};var K={name:null,url:null,authorizationEndpoint:null,scope:null,scopePrefix:null,scopeDelimiter:null,redirectUri:null,requiredUrlParams:null,defaultUrlParams:null,oauthType:"1.0",popupOptions:{}},F=function(e,t,o,r){this.$http=e,this.storage=t,this.providerConfig=h({},K),this.providerConfig=h(this.providerConfig,o),this.options=r};F.prototype.init=function(e){var t=this;return this.oauthPopup=new D("about:blank",this.providerConfig.name,this.providerConfig.popupOptions),R.cordova||this.oauthPopup.open(this.providerConfig.redirectUri,!0),this.getRequestToken().then((function(o){return t.openPopup(o).then((function(o){return t.exchangeForToken(o,e)}))}))},F.prototype.getRequestToken=function(){var e={method:"POST"};return e[this.options.requestDataKey]=h({},this.providerConfig),e.withCredentials=this.options.withCredentials,this.options.baseUrl?e.url=c(this.options.baseUrl,this.providerConfig.url):e.url=this.providerConfig.url,this.$http(e)},F.prototype.openPopup=function(e){var t=[this.providerConfig.authorizationEndpoint,this.buildQueryString(e[this.options.responseDataKey])].join("?");return this.oauthPopup.popup.location=t,R.cordova?this.oauthPopup.open(this.providerConfig.redirectUri):this.oauthPopup.pooling(this.providerConfig.redirectUri)},F.prototype.exchangeForToken=function(e,t){var o=h({},t);o=h(o,e);var r={method:"POST"};return r[this.options.requestDataKey]=o,r.withCredentials=this.options.withCredentials,this.options.baseUrl?r.url=c(this.options.baseUrl,this.providerConfig.url):r.url=this.providerConfig.url,this.$http(r)},F.prototype.buildQueryString=function(e){var t=[];for(var o in e){var r=e[o];t.push(encodeURIComponent(o)+"="+encodeURIComponent(r))}return t.join("&")};var $={name:null,url:null,clientId:null,authorizationEndpoint:null,redirectUri:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,requiredUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code",responseGrantType:"authorization_code",refreshGrantType:"refresh_token",refreshType:null,refreshTokenPrefix:null,tokenRequestAsForm:!1,refreshRequestAsForm:!1,pkce:!1,responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"},refreshParams:{clientId:"clientId",grantType:"grantType",scope:"scope"},oauthType:"2.0",popupOptions:{}},z=function(e,t,o,r){this.$http=e,this.storage=t,this.providerConfig=h({},$),this.providerConfig=h(this.providerConfig,o),this.options=r};z.prototype.generateRandomForKey=function(e){return this.storage.getItem(e)||this.storage.setItem(e,s.default.random(64)),console.log(this.storage.getItem(e)),this.storage.getItem(e)},z.prototype.init=function(e){var t=this,o=this.providerConfig.name+"_state";u(this.providerConfig.state)?this.storage.setItem(o,this.providerConfig.state()):"string"==typeof this.providerConfig.state&&this.storage.setItem(o,this.providerConfig.state);var r=[this.providerConfig.authorizationEndpoint,this._stringifyRequestParams()].join("?");if("S256"===this.providerConfig.pkce){if("code"!==this.providerConfig.responseType)throw new Error("Cannot use PKCE with response type "+this.providerConfig.responseType);var s=n.default(this.generateRandomForKey(this.providerConfig.name+"_pkce")),a=i.default.stringify(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");r=r+"&code_challenge="+encodeURIComponent(a)+"&code_challenge_method=S256"}return this.oauthPopup=new D(r,this.providerConfig.name,this.providerConfig.popupOptions),new _((function(r,n){t.oauthPopup.open(t.providerConfig.redirectUri).then((function(i){return"token"!==t.providerConfig.responseType&&t.providerConfig.url?i.state&&i.state!==t.storage.getItem(o)?n(new Error("State parameter value does not match original OAuth request state value")):void t.exchangeForToken(i,e).then((function(e){return t.storage.removeItem(t.providerConfig.name+"_pkce"),e.data})).then(r):r(i)})).catch((function(e){n(e)}))}))},z.prototype.exchangeForToken=function(e,t){var o,r=h({},t);for(var n in this.providerConfig.responseParams){var i=this.providerConfig.responseParams[n];switch(n){case"code":r[i]=e.code;break;case"clientId":r[i]=this.providerConfig.clientId;break;case"redirectUri":r[i]=this.providerConfig.redirectUri;break;case"grantType":r[i]=this.providerConfig.responseGrantType;break;default:r[i]=e[n]}}if(e.state&&(r.state=e.state),o=this.options.baseUrl?c(this.options.baseUrl,this.providerConfig.url):this.providerConfig.url,this.providerConfig.pkce){var s=this.storage.getItem(this.providerConfig.name+"_pkce");s&&(r.code_verifier=s,r.grant_type="authorization_code",console.log(s))}if(this.providerConfig.tokenRequestAsForm){var a=new FormData;for(var p in r){var u=r[p];a.append(p,u)}r=a}return this.$http.post(o,r,{withCredentials:this.options.withCredentials})},z.prototype._stringifyRequestParams=function(){var e=this,t=[];return["defaultUrlParams","requiredUrlParams","optionalUrlParams"].forEach((function(o){e.providerConfig[o]&&Array.isArray(e.providerConfig[o])&&e.providerConfig[o].forEach((function(o){var r=o.replace(/([\:\-\_]+(.))/g,(function(e,t,o,r){return r?o.toUpperCase():o})),n=u(e.providerConfig[o])?e.providerConfig[o]():e.providerConfig[r];if("redirect_uri"!==o||n){if("state"===o){var i=e.providerConfig.name+"_state";n=encodeURIComponent(e.storage.getItem(i))}"scope"===o&&Array.isArray(n)&&(n=n.join(e.providerConfig.scopeDelimiter),e.providerConfig.scopePrefix&&(n=[e.providerConfig.scopePrefix,n].join(e.providerConfig.scopeDelimiter))),t.push([o,n])}}))})),t.map((function(e){return e.join("=")})).join("&")},z.prototype.getRefreshToken=function(e){return"storage"===this.options.refreshType?this.storage.getItem(e):null},z.prototype.refresh=function(e){if(!this.options.storageType)throw new Error("Refreshing is not set");var t={};for(var o in"storage"===this.options.refreshType&&(t.refresh_token=this.getRefreshToken(e)),this.providerConfig.refreshParams){var r=this.providerConfig.refreshParams[o];switch(o){case"clientId":t[r]=this.providerConfig.clientId;break;case"grantType":t[r]=this.providerConfig.refreshGrantType;break;default:t[r]=this.providerConfig[o]}}if(this.providerConfig.refreshRequestAsForm){var n=new FormData;for(var i in t){var s=t[i];n.set(i,s)}t=n}var a=y(this.providerConfig,this.options,0,t);return this.$http(a)};var B=function(e,t){var o=h({},O),r=function(e){switch(e.storageType){case"localStorage":try{return R.localStorage.setItem("testKey","test"),R.localStorage.removeItem("testKey"),new A(e.storageNamespace)}catch(e){}case"sessionStorage":try{return R.sessionStorage.setItem("testKey","test"),R.sessionStorage.removeItem("testKey"),new N(e.storageNamespace)}catch(e){}case"cookieStorage":return new x(e.cookieStorage);case"memoryStorage":default:return new q(e.storageNamespace)}}(o=h(o,t));if(Object.defineProperties(this,{$http:{get:function(){return e}},options:{get:function(){return o}},storage:{get:function(){return r}},tokenName:{get:function(){return this.options.tokenPrefix?[this.options.tokenPrefix,this.options.tokenName].join("_"):this.options.tokenName}},refreshTokenName:{get:function(){return this.options.refreshTokenPrefix?[this.options.refreshTokenPrefix,this.options.refreshTokenName].join("_"):this.options.refreshTokenName}},expirationName:{get:function(){return this.options.expirationPrefix?[this.options.expirationPrefix,this.options.expirationName].join("_"):this.options.expirationName}}}),this.options.bindRequestInterceptor){if(!u(this.options.bindRequestInterceptor))throw new Error("Request interceptor must be functions");this.options.bindRequestInterceptor.call(this,this)}else this.defaultBindRequestInterceptor(this,this);if(this.options.bindResponseInterceptor){if(!u(this.options.bindResponseInterceptor))throw new Error("Response interceptor must be functions");this.options.bindResponseInterceptor.call(this,this)}else this.defaultBindResponseInterceptor(this,this)};function L(e,t){if(!L.installed){L.installed=!0;var o=null;Object.defineProperties(e.prototype,{$auth:{get:function(){if(!o){if(!this.$http)throw new Error("Request handler instance not found");o=new B(this.$http,t)}return o}}})}}return B.prototype.isAuthenticated=function(){var e=this.storage.getItem(this.tokenName);if(e){if(3===e.split(".").length)try{var t=function(e){var t=e.split(".")[1].replace("-","+").replace("_","/");return JSON.parse(window.atob(t))}(e).exp;if("number"==typeof t)return Math.round((new Date).getTime()/1e3)<t}catch(e){return!0}return!0}return!1},B.prototype.isTokenSet=function(){return!a(this.getToken())&&!!this.getToken()},B.prototype.getToken=function(){return this.storage.getItem(this.tokenName)},B.prototype.setToken=function(e,t){e[this.options.responseDataKey]&&(e=e[this.options.responseDataKey]);var o=v(e,t||this.options.tokenPath);o&&this.storage.setItem(this.tokenName,o)},B.prototype.getLoggedInProvider=function(){return this.storage.getItem("LoggedInProvider")},B.prototype.setLoggedInProvider=function(e){this.storage.setItem("LoggedInProvider",e)},B.prototype.getExpiration=function(){return this.options.refreshType?this.storage.getItem(this.expirationName):null},B.prototype.setRefreshToken=function(e,t){if(this.options.refreshType){if(e[this.options.responseDataKey]&&(e=e[this.options.responseDataKey]),this.setExpiration(e),"storage"!==this.options.refreshType)return e;var o=v(e,t||this.options.refreshTokenPath);return!o&&e&&(o=e[this.options.expirationName]),o&&this.storage.setItem(this.refreshTokenName,o),e}},B.prototype.setExpiration=function(e){var t;if(e.expires_in){var o=parseInt(e.expires_in);isNaN(o)&&(o=0),t=Math.round((new Date).getTime()/1e3)+o}if(!t&&e){var r=parseInt(e[this.options.expirationName]);isNaN(r)&&(r=0),t=Math.round((new Date).getTime()/1e3)+r}return t&&this.storage.setItem(this.expirationName,t),e},B.prototype.getPayload=function(){var e=this.storage.getItem(this.tokenName);if(e&&3===e.split(".").length)try{var t=e.split(".")[1].replace("-","+").replace("_","/");return JSON.parse(d(t))}catch(e){}},B.prototype.login=function(e,t){var o=this;return t=y(t,this.options,0,e),this.$http(t).then((function(e){if(o.setToken(e),o.setRefreshToken(e),o.isAuthenticated())return _.resolve(e);throw new Error("Server did not provided an access token.")})).catch((function(e){return _.reject(e)}))},B.prototype.register=function(e,t){var o=this;return t=y(t,this.options,0,e),this.$http(t).then((function(e){return o.setToken(e),o.setRefreshToken(e),_.resolve(e)})).catch((function(e){return _.reject(e)}))},B.prototype.logout=function(e){var t=this;return this.isAuthenticated()?(e=e||{}).url||this.options.logoutUrl?(e.url=e.url?e.url:c(this.options.baseUrl,this.options.logoutUrl),e.method=e.method||"POST",e[this.options.requestDataKey]=e[this.options.requestDataKey]||void 0,e.withCredentials=e.withCredentials||this.options.withCredentials,this.$http(e).then((function(e){return t.storage.removeItem(t.tokenName),_.resolve(e)})).catch((function(e){return _.reject(e)}))):(this.storage.removeItem(this.tokenName),_.resolve()):_.reject(new Error("There is no currently authenticated user"))},B.prototype.refresh=function(){var e,t=this,o=this.getLoggedInProvider(),r=this.options.providers[o],n=this.refreshTokenName;if(!r)return reject(new Error("Unknown provider"));switch(r.oauthType){case"2.0":e=new z(this.$http,this.storage,r,this.options);break;default:return reject(new Error("Invalid OAuth type for refresh"))}return e.refresh(n).then((function(e){return t.setToken(e),t.setRefreshToken(e),e})).catch((function(e){throw t.clearStorage(),e}))},B.prototype.clearStorage=function(){this.storage.removeItem(this.tokenName),this.storage.removeItem(this.expirationName),this.storage.removeItem(this.refreshTokenName)},B.prototype.authenticate=function(e,t){var o=this;return new _((function(r,n){var i,s=o.options.providers[e];if(!s)return n(new Error("Unknown provider"));switch(s.oauthType){case"1.0":i=new F(o.$http,o.storage,s,o.options);break;case"2.0":i=new z(o.$http,o.storage,s,o.options);break;default:return n(new Error("Invalid OAuth type"))}return i.init(t).then((function(t){return o.setToken(t,s.tokenPath),o.setRefreshToken(t,s.refreshTokenPath),o.setLoggedInProvider(e),o.isAuthenticated()?r(t):n(new Error("Authentication failed"))})).catch((function(e){return n(e)}))}))},B.prototype.link=function(e,t){var o=this;return new _((function(r,n){var i,s=o.options.providers[e];if(!s)return n(new Error("Unknown provider"));switch(s.oauthType){case"1.0":i=new F(o.$http,o.storage,s,o.options);break;case"2.0":i=new z(o.$http,o.storage,s,o.options);break;default:return n(new Error("Invalid OAuth type"))}return i.init(t).then((function(e){e[o.options.responseDataKey]&&(e=e[o.options.responseDataKey]),r(e)})).catch(n)}))},B.prototype.defaultBindRequestInterceptor=function(e){var t=e.options.tokenHeader;e.$http.interceptors.request.use((function(o){return e.isAuthenticated()?o.headers[t]=[e.options.tokenType,e.getToken()].join(" "):delete o.headers[t],o}))},B.prototype.runAuthInterceptor=function(e){var t=[],o=_.reject(e);for(this.options.refreshAuthFailInterceptors.forEach((function(e){t.unshift(e)}));t.length;)o=o.catch(t.shift());return o},B.prototype.defaultBindResponseInterceptor=function(e){e.$http.interceptors.response.use((function(e){return e}),(function(t){var o=t.config,r=t.response.status,n=o;if(401===r&&e.options.refreshType){if(console.log("Got 401 with refresh type"),!e.isTokenSet())return console.log("Token was not set"),e.runAuthInterceptor(t);if(console.log("Token was set"),e._isRefreshing)return new _((function(t,o){setTimeout((function(){e.$http(n).then(t).catch(o)}),100)}));if(e.last_token_refresh_attempt&&new Date-e.last_token_refresh_attempt<3e4)return e.runAuthInterceptor(t);e._isRefreshing=!0,e.last_token_refresh_attempt=new Date;try{return e.refresh().then((function(t){return e._isRefreshing=!1,e.$http(n)})).catch((function(t){return e._isRefreshing=!1,e.runAuthInterceptor(t)}))}catch(o){return console.log("Shouldn't be here!"),console.log(o),e._isRefreshing=!1,e.runAuthInterceptor(t)}}return console.log("fell through"),_.reject(t)}))},L.factory=function(e,t){return new B(e,t)},L}));
