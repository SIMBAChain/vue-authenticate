/**
 * vue-authenticate v1.5.8
 * https://github.com/dgrubelic/vue-authenticate
 * Released under the MIT License.
 * 
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("crypto-js/sha256"),require("crypto-js/enc-base64"),require("crypto-js/lib-typedarrays")):"function"==typeof define&&define.amd?define(["crypto-js/sha256","crypto-js/enc-base64","crypto-js/lib-typedarrays"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).VueAuthenticate=t(e.sha256,e.Base64,e.WordArray)}(this,function(e,t,o){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=r(e),a=r(t),n=r(o);function i(e){return void 0===e}function p(e){return"function"==typeof e}function u(t,o){return null==t||null==o||Object.keys(o).forEach(function(e){"[object Object]"!=Object.prototype.toString.call(o[e])||"[object Object]"!=Object.prototype.toString.call(t[e])?t[e]=o[e]:t[e]=u(t[e],o[e])}),t}function h(e,t){if(/^(?:[a-z]+:)?\/\//i.test(t))return t;return[e,t].join("/").replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")}function c(e){var t="https:"===e.protocol;return e.protocol+"//"+e.hostname+":"+(e.port||(t?"443":"80"))+(/^\//.test(e.pathname)?e.pathname:"/"+e.pathname)}function l(e){var t,o,r={};return(e||"").split("&").forEach(function(e){e&&(o=e.split("="),t=decodeURIComponent(o[0]),r[t]=!o[1]||decodeURIComponent(o[1]))}),r}function f(e){var t;if("undefined"!=typeof module&&module.exports)try{t=require("buffer").Buffer}catch(e){}function o(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return r(55296+(t>>>10))+r(56320+(1023&t));case 3:return r((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return r((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}}var r=String.fromCharCode,n=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g");return(t?function(e){return(e.constructor===t.constructor?e:new t(e,"base64")).toString()}:function(e){return atob(e).replace(n,o)})(String(e).replace(/[-_]/g,function(e){return"-"===e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))}function d(e,t,o){return[encodeURIComponent(e),"=",encodeURIComponent(t),(e=(r=o).path,t=r.domain,o=r.expires,r=r.secure,[null==e?"":";path="+e,null==t?"":";domain="+t,null==o?"":";expires="+o.toUTCString(),null==r||!1===r?"":";secure"].join(""))].join("");var r}function g(e,t){for(var o,r=void 0,n=e,i=t.split("."),s=0;s<i.length;s++){var a=i[s],r=n[a];if(null===(o=r)||"object"!=typeof o)break;n=n[a]}return r}function m(e,t,o,r){return(e=e||{}).url=e.url||t.url||h(t.baseUrl,t.loginUrl),e[t.requestDataKey]=r||e[t.requestDataKey],e.method=e.method||"POST",e.withCredentials=e.withCredentials||t.withCredentials,e}"function"!=typeof Object.assign&&(Object.assign=function(e,t){var o=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1;n<arguments.length;n++){var i=o[n];if(null!=i)for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])}return r});var y=setTimeout;function v(){}function w(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],b(e,this)}function k(o,r){for(;3===o._state;)o=o._value;0!==o._state?(o._handled=!0,w._immediateFn(function(){var e,t=1===o._state?r.onFulfilled:r.onRejected;if(null!==t){try{e=t(o._value)}catch(e){return void I(r.promise,e)}_(r.promise,e)}else(1===o._state?_:I)(r.promise,o._value)})):o._deferreds.push(r)}function _(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var o=e.then;if(e instanceof w)return t._state=3,t._value=e,void C(t);if("function"==typeof o)return void b((r=o,n=e,function(){r.apply(n,arguments)}),t)}t._state=1,t._value=e,C(t)}catch(e){I(t,e)}var r,n}function I(e,t){e._state=2,e._value=t,C(e)}function C(e){2===e._state&&0===e._deferreds.length&&w._immediateFn(function(){e._handled||w._unhandledRejectionFn(e._value)});for(var t=0,o=e._deferreds.length;t<o;t++)k(e,e._deferreds[t]);e._deferreds=null}function T(e,t,o){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=o}function b(e,t){var o=!1;try{e(function(e){o||(o=!0,_(t,e))},function(e){o||(o=!0,I(t,e))})}catch(e){if(o)return;o=!0,I(t,e)}}w.prototype.catch=function(e){return this.then(null,e)},w.prototype.then=function(e,t){var o=new this.constructor(v);return k(this,new T(e,t,o)),o},w.all=function(e){var a=Array.prototype.slice.call(e);return new w(function(n,i){if(0===a.length)return n([]);var s=a.length;for(var e=0;e<a.length;e++)!function t(o,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if("function"==typeof r)return void r.call(e,function(e){t(o,e)},i)}a[o]=e,0==--s&&n(a)}catch(e){i(e)}}(e,a[e])})},w.resolve=function(t){return t&&"object"==typeof t&&t.constructor===w?t:new w(function(e){e(t)})},w.reject=function(o){return new w(function(e,t){t(o)})},w.race=function(n){return new w(function(e,t){for(var o=0,r=n.length;o<r;o++)n[o].then(e,t)})},w._immediateFn="function"==typeof setImmediate?function(e){setImmediate(e)}:function(e){y(e,0)},w._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},w._setImmediateFn=function(e){w._immediateFn=e},w._setUnhandledRejectionFn=function(e){w._unhandledRejectionFn=e};var P="undefined"!=typeof document?document:{createElement:function(){}},U="undefined"!=typeof window?window:{atob:function(){},open:function(){},location:{},localStorage:{setItem:function(){},getItem:function(){},removeItem:function(){}},sessionStorage:{setItem:function(){},getItem:function(){},removeItem:function(){}}};function j(){try{return U.location.hostname}catch(e){}return""}function R(e){try{return i(e)?U.location.origin:""+U.location.origin+e}catch(e){}return e||null}function S(e){this._defaultOptions=u({domain:j(),expires:null,path:"/",secure:!1},e)}var E={baseUrl:null,tokenPath:"access_token",refreshTokenPath:"refresh_token",tokenName:"token",tokenPrefix:"vueauth",tokenHeader:"Authorization",tokenType:"Bearer",expirationName:"expiration",expirationPrefix:null,loginUrl:"/auth/login",registerUrl:"/auth/register",logoutUrl:null,refreshUrl:"/auth/login/refresh",storageType:"localStorage",storageNamespace:"vue-authenticate",cookieStorage:{domain:j(),path:"/",secure:!1},requestDataKey:"data",responseDataKey:"data",last_token_refresh_attempt:null,refreshAuthFailInterceptors:[],bindRequestInterceptor:null,bindResponseInterceptor:null,providers:{facebook:{name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:R("/"),requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",oauthType:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:R(),requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:452,height:633}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:R(),optionalUrlParams:["scope"],scope:["user:email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",authorizationEndpoint:"https://api.instagram.com/oauth/authorize",redirectUri:R(),requiredUrlParams:["scope"],scope:["basic"],scopeDelimiter:"+",oauthType:"2.0",popupOptions:{width:null,height:null}},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:R(),oauthType:"1.0",popupOptions:{width:495,height:645}},bitbucket:{name:"bitbucket",url:"/auth/bitbucket",authorizationEndpoint:"https://bitbucket.org/site/oauth2/authorize",redirectUri:R("/"),optionalUrlParams:["scope"],scope:["email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",redirectUri:R(),requiredUrlParams:["state","scope"],scope:["r_emailaddress"],scopeDelimiter:" ",state:"STATE",oauthType:"2.0",popupOptions:{width:527,height:582}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",redirectUri:R(),requiredUrlParams:["display","scope"],scope:["wl.emails"],scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:500,height:560}},oauth1:{name:null,url:"/auth/oauth1",authorizationEndpoint:null,redirectUri:R(),oauthType:"1.0",popupOptions:null},oauth2:{name:null,url:"/auth/oauth2",clientId:null,redirectUri:R(),authorizationEndpoint:null,defaultUrlParams:["response_type","client_id","redirect_uri"],requiredUrlParams:null,optionalUrlParams:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,oauthType:"2.0",popupOptions:null,responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"}}}};S.prototype.setItem=function(e,t){t=d(e,t,u({},this._defaultOptions));this._setCookie(t)},S.prototype.getItem=function(e){var t=function(e){if(0===(e=void 0===e?"":e).length)return{};var o={},t=new RegExp("\\s*;\\s*");return e.split(t).forEach(function(e){var t=e.split("="),e=t[0],t=t[1],e=decodeURIComponent(e),t=decodeURIComponent(t);o[e]=t}),o}(this._getCookie());return t.hasOwnProperty(e)?t[e]:null},S.prototype.removeItem=function(e){var t=u({},this._defaultOptions),t=d(e,"",u(t,{expires:new Date(0)}));this._setCookie(t)},S.prototype._getCookie=function(){try{return"undefined"===P.cookie?"":P.cookie}catch(e){}return""},S.prototype._setCookie=function(e){try{P.cookie=e}catch(e){}};function O(e){this.namespace=e||null}O.prototype.setItem=function(e,t){U.localStorage.setItem(this._getStorageKey(e),t)},O.prototype.getItem=function(e){return U.localStorage.getItem(this._getStorageKey(e))},O.prototype.removeItem=function(e){U.localStorage.removeItem(this._getStorageKey(e))},O.prototype._getStorageKey=function(e){return this.namespace?[this.namespace,e].join("."):e};function x(e){this.namespace=e||null,this._storage={}}x.prototype.setItem=function(e,t){this._storage[this._getStorageKey(e)]=t},x.prototype.getItem=function(e){return this._storage[this._getStorageKey(e)]},x.prototype.removeItem=function(e){delete this._storage[this._getStorageKey(e)]},x.prototype._getStorageKey=function(e){return this.namespace?[this.namespace,e].join("."):e};function A(e){this.namespace=e||null}A.prototype.setItem=function(e,t){U.sessionStorage.setItem(this._getStorageKey(e),t)},A.prototype.getItem=function(e){return U.sessionStorage.getItem(this._getStorageKey(e))},A.prototype.removeItem=function(e){U.sessionStorage.removeItem(this._getStorageKey(e))},A.prototype._getStorageKey=function(e){return this.namespace?[this.namespace,e].join("."):e};function q(e,t,o){this.popup=null,this.url=e,this.name=t,this.popupOptions=o}q.prototype.open=function(e,t){try{return this.popup=U.open(this.url,this.name,this._stringifyOptions()),this.popup&&this.popup.focus&&this.popup.focus(),t?w.resolve():this.pooling(e)}catch(e){return w.reject(new Error("OAuth popup error occurred"))}},q.prototype.pooling=function(t){var a=this;return new w(function(r,n){var e=P.createElement("a");e.href=t;var i=c(e),s=setInterval(function(){a.popup&&!a.popup.closed&&void 0!==a.popup.closed||(clearInterval(s),s=null,n(new Error("Auth popup window closed")));try{var e,t,o;c(a.popup.location)===i&&(a.popup.location.search||a.popup.location.hash?(e=l(a.popup.location.search.substring(1).replace(/\/$/,"")),t=l(a.popup.location.hash.substring(1).replace(/[\/$]/,"")),o=u({},e),(o=u(o,t)).error?n(new Error(o.error)):r(o)):n(new Error("OAuth redirect has occurred but no query or hash parameters were found.")),clearInterval(s),s=null,a.popup.close())}catch(e){}},250)})},q.prototype._stringifyOptions=function(){var e,t=[];for(e in this.popupOptions)i(this.popupOptions[e])||t.push(e+"="+this.popupOptions[e]);return t.join(",")};function N(e,t,o,r){this.$http=e,this.storage=t,this.providerConfig=u({},D),this.providerConfig=u(this.providerConfig,o),this.options=r}var D={name:null,url:null,authorizationEndpoint:null,scope:null,scopePrefix:null,scopeDelimiter:null,redirectUri:null,requiredUrlParams:null,defaultUrlParams:null,oauthType:"1.0",popupOptions:{}};N.prototype.init=function(t){var o=this;return this.oauthPopup=new q("about:blank",this.providerConfig.name,this.providerConfig.popupOptions),U.cordova||this.oauthPopup.open(this.providerConfig.redirectUri,!0),this.getRequestToken().then(function(e){return o.openPopup(e).then(function(e){return o.exchangeForToken(e,t)})})},N.prototype.getRequestToken=function(){var e={method:"POST"};return e[this.options.requestDataKey]=u({},this.providerConfig),e.withCredentials=this.options.withCredentials,this.options.baseUrl?e.url=h(this.options.baseUrl,this.providerConfig.url):e.url=this.providerConfig.url,this.$http(e)},N.prototype.openPopup=function(e){e=[this.providerConfig.authorizationEndpoint,this.buildQueryString(e[this.options.responseDataKey])].join("?");return this.oauthPopup.popup.location=e,U.cordova?this.oauthPopup.open(this.providerConfig.redirectUri):this.oauthPopup.pooling(this.providerConfig.redirectUri)},N.prototype.exchangeForToken=function(e,t){t=u({},t),t=u(t,e),e={method:"POST"};return e[this.options.requestDataKey]=t,e.withCredentials=this.options.withCredentials,this.options.baseUrl?e.url=h(this.options.baseUrl,this.providerConfig.url):e.url=this.providerConfig.url,this.$http(e)};function K(e,t,o,r){this.$http=e,this.storage=t,this.providerConfig=u({},F),this.providerConfig=u(this.providerConfig,o),this.options=r}var F={name:null,url:null,clientId:null,authorizationEndpoint:null,redirectUri:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,requiredUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code",responseGrantType:"authorization_code",refreshGrantType:"refresh_token",refreshType:null,refreshTokenPrefix:null,tokenRequestAsForm:!(N.prototype.buildQueryString=function(e){var t,o=[];for(t in e){var r=e[t];o.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}return o.join("&")}),refreshRequestAsForm:!1,pkce:!1,responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"},refreshParams:{clientId:"clientId",grantType:"grantType",scope:"scope"},oauthType:"2.0",popupOptions:{}};K.prototype.generateRandomForKey=function(e){return this.storage.getItem(e)||this.storage.setItem(e,n.default.random(64)),console.log(this.storage.getItem(e)),this.storage.getItem(e)},K.prototype.init=function(r){var n=this,i=this.providerConfig.name+"_state";p(this.providerConfig.state)?this.storage.setItem(i,this.providerConfig.state()):"string"==typeof this.providerConfig.state&&this.storage.setItem(i,this.providerConfig.state);var e=[this.providerConfig.authorizationEndpoint,this._stringifyRequestParams()].join("?");if("S256"===this.providerConfig.pkce){if("code"!==this.providerConfig.responseType)throw new Error("Cannot use PKCE with response type "+this.providerConfig.responseType);var t=s.default(this.generateRandomForKey(this.providerConfig.name+"_pkce")),t=a.default.stringify(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),e=e+"&code_challenge="+encodeURIComponent(t)+"&code_challenge_method=S256"}return this.oauthPopup=new q(e,this.providerConfig.name,this.providerConfig.popupOptions),new w(function(t,o){n.oauthPopup.open(n.providerConfig.redirectUri).then(function(e){return"token"!==n.providerConfig.responseType&&n.providerConfig.url?e.state&&e.state!==n.storage.getItem(i)?o(new Error("State parameter value does not match original OAuth request state value")):void n.exchangeForToken(e,r).then(function(e){return n.storage.removeItem(n.providerConfig.name+"_pkce"),e.data}).then(t):t(e)}).catch(function(e){o(e)})})},K.prototype.exchangeForToken=function(e,t){var o,r,n=u({},t);for(o in this.providerConfig.responseParams){var i=this.providerConfig.responseParams[o];switch(o){case"code":n[i]=e.code;break;case"clientId":n[i]=this.providerConfig.clientId;break;case"redirectUri":n[i]=this.providerConfig.redirectUri;break;case"grantType":n[i]=this.providerConfig.responseGrantType;break;default:n[i]=e[o]}}if(e.state&&(n.state=e.state),r=this.options.baseUrl?h(this.options.baseUrl,this.providerConfig.url):this.providerConfig.url,!this.providerConfig.pkce||(t=this.storage.getItem(this.providerConfig.name+"_pkce"))&&(n.code_verifier=t,n.grant_type="authorization_code",console.log(t)),this.providerConfig.tokenRequestAsForm){var s,a=new FormData;for(s in n){var p=n[s];a.append(s,p)}n=a}return this.$http.post(r,n,{withCredentials:this.options.withCredentials})},K.prototype._stringifyRequestParams=function(){var r=this,n=[];return["defaultUrlParams","requiredUrlParams","optionalUrlParams"].forEach(function(e){r.providerConfig[e]&&Array.isArray(r.providerConfig[e])&&r.providerConfig[e].forEach(function(e){var t=e.replace(/([\:\-\_]+(.))/g,function(e,t,o,r){return r?o.toUpperCase():o}),o=p(r.providerConfig[e])?r.providerConfig[e]():r.providerConfig[t];"redirect_uri"===e&&!o||("state"===e&&(t=r.providerConfig.name+"_state",o=encodeURIComponent(r.storage.getItem(t))),"scope"===e&&Array.isArray(o)&&(o=o.join(r.providerConfig.scopeDelimiter),r.providerConfig.scopePrefix&&(o=[r.providerConfig.scopePrefix,o].join(r.providerConfig.scopeDelimiter))),n.push([e,o]))})}),n.map(function(e){return e.join("=")}).join("&")},K.prototype.getRefreshToken=function(e){return"storage"===this.options.refreshType?this.storage.getItem(e):null},K.prototype.refresh=function(e){if(!this.options.storageType)throw new Error("Refreshing is not set");var t,o={};for(t in"storage"===this.options.refreshType&&(o.refresh_token=this.getRefreshToken(e)),this.providerConfig.refreshParams){var r=this.providerConfig.refreshParams[t];switch(t){case"clientId":o[r]=this.providerConfig.clientId;break;case"grantType":o[r]=this.providerConfig.refreshGrantType;break;default:o[r]=this.providerConfig[t]}}if(this.providerConfig.refreshRequestAsForm){var n,i=new FormData;for(n in o){var s=o[n];i.set(n,s)}o=i}e=m(this.providerConfig,this.options,0,o);return this.$http(e)};var $=function(e,t){var o=u({},E),r=function(e){switch(e.storageType){case"localStorage":try{return U.localStorage.setItem("testKey","test"),U.localStorage.removeItem("testKey"),new O(e.storageNamespace)}catch(e){}case"sessionStorage":try{return U.sessionStorage.setItem("testKey","test"),U.sessionStorage.removeItem("testKey"),new A(e.storageNamespace)}catch(e){}case"cookieStorage":return new S(e.cookieStorage);case"memoryStorage":default:return new x(e.storageNamespace)}}(o=u(o,t));if(Object.defineProperties(this,{$http:{get:function(){return e}},options:{get:function(){return o}},storage:{get:function(){return r}},tokenName:{get:function(){return this.options.tokenPrefix?[this.options.tokenPrefix,this.options.tokenName].join("_"):this.options.tokenName}},refreshTokenName:{get:function(){return this.options.refreshTokenPrefix?[this.options.refreshTokenPrefix,this.options.refreshTokenName].join("_"):this.options.refreshTokenName}},expirationName:{get:function(){return this.options.expirationPrefix?[this.options.expirationPrefix,this.options.expirationName].join("_"):this.options.expirationName}}}),this.options.bindRequestInterceptor){if(!p(this.options.bindRequestInterceptor))throw new Error("Request interceptor must be functions");this.options.bindRequestInterceptor.call(this,this)}else this.defaultBindRequestInterceptor(this,this);if(this.options.bindResponseInterceptor){if(!p(this.options.bindResponseInterceptor))throw new Error("Response interceptor must be functions");this.options.bindResponseInterceptor.call(this,this)}else this.defaultBindResponseInterceptor(this,this)};function z(e,t){var o;z.installed||(z.installed=!0,o=null,Object.defineProperties(e.prototype,{$auth:{get:function(){if(!o){if(!this.$http)throw new Error("Request handler instance not found");o=new $(this.$http,t)}return o}}}))}return $.prototype.isAuthenticated=function(){var e,t=this.storage.getItem(this.tokenName);if(t){if(3===t.split(".").length)try{var o=(e=(e=t).split(".")[1].replace("-","+").replace("_","/"),JSON.parse(window.atob(e)).exp);if("number"==typeof o)return Math.round((new Date).getTime()/1e3)<o}catch(e){return!0}return!0}return!1},$.prototype.isTokenSet=function(){return!i(this.getToken())&&!!this.getToken()},$.prototype.getToken=function(){return this.storage.getItem(this.tokenName)},$.prototype.setToken=function(e,t){t=g(e=e[this.options.responseDataKey]?e[this.options.responseDataKey]:e,t||this.options.tokenPath);t&&this.storage.setItem(this.tokenName,t)},$.prototype.getLoggedInProvider=function(){return this.storage.getItem("LoggedInProvider")},$.prototype.setLoggedInProvider=function(e){this.storage.setItem("LoggedInProvider",e)},$.prototype.getExpiration=function(){return this.options.refreshType?this.storage.getItem(this.expirationName):null},$.prototype.setRefreshToken=function(e,t){if(this.options.refreshType){if(e[this.options.responseDataKey]&&(e=e[this.options.responseDataKey]),this.setExpiration(e),"storage"!==this.options.refreshType)return e;t=g(e,t||this.options.refreshTokenPath);return(t=!t&&e?e[this.options.expirationName]:t)&&this.storage.setItem(this.refreshTokenName,t),e}},$.prototype.setExpiration=function(e){var t,o;return e.expires_in&&(o=parseInt(e.expires_in),isNaN(o)&&(o=0),t=Math.round((new Date).getTime()/1e3)+o),!t&&e&&(o=parseInt(e[this.options.expirationName]),isNaN(o)&&(o=0),t=Math.round((new Date).getTime()/1e3)+o),t&&this.storage.setItem(this.expirationName,t),e},$.prototype.getPayload=function(){var e=this.storage.getItem(this.tokenName);if(e&&3===e.split(".").length)try{var t=e.split(".")[1].replace("-","+").replace("_","/");return JSON.parse(f(t))}catch(e){}},$.prototype.login=function(e,t){var o=this;return t=m(t,this.options,0,e),this.$http(t).then(function(e){if(o.setToken(e),o.setRefreshToken(e),o.isAuthenticated())return w.resolve(e);throw new Error("Server did not provided an access token.")}).catch(function(e){return w.reject(e)})},$.prototype.register=function(e,t){var o=this;return t=m(t,this.options,0,e),this.$http(t).then(function(e){return o.setToken(e),o.setRefreshToken(e),w.resolve(e)}).catch(function(e){return w.reject(e)})},$.prototype.logout=function(e){var t=this;return this.isAuthenticated()?(e=e||{}).url||this.options.logoutUrl?(e.url=e.url||h(this.options.baseUrl,this.options.logoutUrl),e.method=e.method||"POST",e[this.options.requestDataKey]=e[this.options.requestDataKey]||void 0,e.withCredentials=e.withCredentials||this.options.withCredentials,this.$http(e).then(function(e){return t.storage.removeItem(t.tokenName),w.resolve(e)}).catch(function(e){return w.reject(e)})):(this.storage.removeItem(this.tokenName),w.resolve()):w.reject(new Error("There is no currently authenticated user"))},$.prototype.refresh=function(){var t=this,e=this.getLoggedInProvider(),o=this.options.providers[e],e=this.refreshTokenName;return o?"2.0"!==o.oauthType?reject(new Error("Invalid OAuth type for refresh")):new K(this.$http,this.storage,o,this.options).refresh(e).then(function(e){return t.setToken(e),t.setRefreshToken(e),e}).catch(function(e){throw t.clearStorage(),e}):reject(new Error("Unknown provider"))},$.prototype.clearStorage=function(){this.storage.removeItem(this.tokenName),this.storage.removeItem(this.expirationName),this.storage.removeItem(this.refreshTokenName)},$.prototype.authenticate=function(n,i){var s=this;return new w(function(t,o){var e,r=s.options.providers[n];if(!r)return o(new Error("Unknown provider"));switch(r.oauthType){case"1.0":e=new N(s.$http,s.storage,r,s.options);break;case"2.0":e=new K(s.$http,s.storage,r,s.options);break;default:return o(new Error("Invalid OAuth type"))}return e.init(i).then(function(e){return s.setToken(e,r.tokenPath),s.setRefreshToken(e,r.refreshTokenPath),s.setLoggedInProvider(n),s.isAuthenticated()?t(e):o(new Error("Authentication failed"))}).catch(function(e){return o(e)})})},$.prototype.link=function(n,i){var s=this;return new w(function(t,e){var o,r=s.options.providers[n];if(!r)return e(new Error("Unknown provider"));switch(r.oauthType){case"1.0":o=new N(s.$http,s.storage,r,s.options);break;case"2.0":o=new K(s.$http,s.storage,r,s.options);break;default:return e(new Error("Invalid OAuth type"))}return o.init(i).then(function(e){e[s.options.responseDataKey]&&(e=e[s.options.responseDataKey]),t(e)}).catch(e)})},$.prototype.defaultBindRequestInterceptor=function(t){var o=t.options.tokenHeader;t.$http.interceptors.request.use(function(e){return t.isAuthenticated()?e.headers[o]=[t.options.tokenType,t.getToken()].join(" "):delete e.headers[o],e})},$.prototype.runAuthInterceptor=function(e){var t=[],o=w.reject(e);for(this.options.refreshAuthFailInterceptors.forEach(function(e){t.unshift(e)});t.length;)o=o.catch(t.shift());return o},$.prototype.defaultBindResponseInterceptor=function(n){n.$http.interceptors.response.use(function(e){return e},function(t){var e=t.config,o=t.response.status,r=e;if(401===o&&n.options.refreshType){if(console.log("Got 401 with refresh type"),!n.isTokenSet())return console.log("Token was not set"),n.runAuthInterceptor(t);if(console.log("Token was set"),n._isRefreshing)return new w(function(e,t){setTimeout(function(){n.$http(r).then(e).catch(t)},100)});if(n.last_token_refresh_attempt&&new Date-n.last_token_refresh_attempt<3e4)return n.runAuthInterceptor(t);n._isRefreshing=!0,n.last_token_refresh_attempt=new Date;try{return n.refresh().then(function(e){return n._isRefreshing=!1,n.$http(r)}).catch(function(e){return n._isRefreshing=!1,n.runAuthInterceptor(e)})}catch(e){return console.log("Shouldn't be here!"),console.log(e),n._isRefreshing=!1,n.runAuthInterceptor(t)}}return console.log("fell through"),w.reject(t)})},z.factory=function(e,t){return new $(e,t)},z});
